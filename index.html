<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Member</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body{font-family:system-ui;margin:0;background:#f5f7fb}
    .wrap{max-width:420px;margin:0 auto;padding:16px}
    .card{background:#fff;border-radius:16px;padding:16px}
    .muted{color:#6b7280;font-size:13px}
    .big{font-size:22px;font-weight:800}
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div id="status" class="muted">กำลังโหลด...</div>
    <p>แต้มแลกของ: <span id="redeemPts">-</span></p>
    <p>แต้มสะสมเลเวล: <span id="levelPts">-</span></p>
  </div>
</div>

<script>
const LIFF_ID = "2008701497-IOxPqnn3";
const API_URL = "https://script.google.com/macros/s/AKfycbzmHnsk7fadmCwyXduQkPyhITIUI4deTeZI_ZGTW58bsUr_v2QakqLj0Vc3dFd1_dB6/exec";

async function main(){
  try{
    document.getElementById("status").innerText = "เริ่มต้น LIFF...";
    await liff.init({ liffId: LIFF_ID });

    if(!liff.isLoggedIn()){
      liff.login();
      return;
    }

    document.getElementById("status").innerText = "ดึงข้อมูล LINE...";
    const profile = await liff.getProfile();

    document.getElementById("status").innerText = "สมัครสมาชิก...";
    const res = await fetch(
      `${API_URL}?action=member&userId=${profile.userId}&name=${encodeURIComponent(profile.displayName)}`
    );
    const data = await res.json();

    document.getElementById("status").innerText = "ดึงแต้ม...";
    const w = await fetch(
      `${API_URL}?action=wallet&memberId=${data.member_id}`
    );
    const wallet = await w.json();

    document.getElementById("redeemPts").innerText = wallet.points?.redeem ?? 0;
    document.getElementById("levelPts").innerText = wallet.points?.level ?? 0;

    document.getElementById("status").innerText = "โหลดสำเร็จ";

  }catch(e){
    document.getElementById("status").innerText = "ERROR: " + e;
  }
}

main();
</script>
</body>
</html>
