<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MIRO | จองบริการ</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
  :root{
    --bg:#f3f7ff;
    --card:#ffffff;
    --ink:#0b2b5a;
    --muted:#5b6b80;
    --line:#dbe7ff;
    --primary:#1677ff;
    --primary2:#0ea5e9;
    --danger:#dc2626;
    --ok:#0f766e;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto;background:var(--bg);color:var(--ink)}
  .wrap{max-width:760px;margin:0 auto;padding:18px 16px 40px}
  .topbar{
    display:flex;align-items:center;justify-content:space-between;gap:12px;
    padding:14px 16px;border:1px solid var(--line);border-radius:16px;
    background:linear-gradient(135deg,#ffffff, #f8fbff);
    box-shadow:0 10px 24px rgba(15,23,42,.08);
  }
  .brand{display:flex;flex-direction:column;gap:2px}
  .brand .h{font-weight:900;font-size:16px}
  .brand .s{color:var(--muted);font-size:12.5px}
  .pill{
    padding:8px 10px;border-radius:999px;border:1px solid var(--line);
    background:#fff;font-size:12px
  }
  .card{
    margin-top:14px;background:var(--card);
    border:1px solid var(--line);border-radius:18px;
    box-shadow:0 18px 40px rgba(15,23,42,.08);
    overflow:hidden;
  }
  .head{
    padding:18px;
    background:linear-gradient(135deg, #eaf2ff, #f7fbff);
    border-bottom:1px solid var(--line);
  }
  .head h1{margin:0;font-size:18px;font-weight:900}
  .head p{margin:6px 0 0;color:var(--muted);font-size:13px}
  .stepbar{display:flex;gap:8px;margin-top:12px}
  .step{flex:1;height:8px;border-radius:999px;background:#e6eefc}
  .step i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--primary),var(--primary2))}
  .body{padding:18px}
  label{display:block;font-size:12px;color:var(--muted);margin-top:12px}
  input,select,textarea{
    width:100%;margin-top:6px;padding:12px;
    border-radius:12px;border:1px solid #d6e3ff;font-size:14px
  }
  textarea{min-height:96px}
  .req{color:var(--danger);font-weight:900}
  .row{display:flex;gap:10px;margin-top:12px}
  .btn{
    border:0;border-radius:14px;padding:12px 14px;
    font-weight:900;background:var(--primary);color:#fff;cursor:pointer
  }
  .btn.secondary{background:#fff;color:#0f172a;border:1px solid var(--line)}
  .btn:disabled{opacity:.6}
  .note{
    margin-top:12px;border-radius:14px;padding:12px;
    border:1px solid var(--line);background:#f8fbff;font-size:13px
  }
  .alert{
    margin-top:12px;border-radius:14px;padding:12px;
    font-size:13px;white-space:pre-wrap
  }
  .alert.err{background:#fff1f2;border:1px solid #fecaca;color:#991b1b}
  .alert.ok{background:#ecfeff;border:1px solid #a5f3fc;color:#155e75}
  .divider{height:1px;background:#e6eefc;margin:16px 0}
  .foot{
    padding:14px;border-top:1px solid var(--line);
    display:flex;justify-content:space-between;gap:12px
  }
</style>
</head>
<body>
<div class="wrap">

<div class="topbar">
  <div class="brand">
    <div class="h">MIRO Cleaning</div>
    <div class="s">แบบฟอร์มขอรับบริการ</div>
  </div>
  <div id="who" class="pill">กำลังตรวจสอบผู้ใช้งาน</div>
</div>

<div class="card">
  <div class="head">
    <h1>จองบริการ</h1>
    <p>กรอกข้อมูลเพื่อให้ทีมงานติดต่อกลับและยืนยันคิว</p>
    <div class="stepbar">
      <div class="step"><i id="p1"></i></div>
      <div class="step"><i id="p2"></i></div>
      <div class="step"><i id="p3"></i></div>
      <div class="step"><i id="p4"></i></div>
    </div>
  </div>

  <div class="body">
    <div id="msg"></div>

    <!-- STEP 1 -->
    <div id="step1">
      <label>ประเภทบริการ <span class="req">*</span></label>
      <select id="service_type">
        <option value="">เลือกบริการ</option>
        <option>ทำความสะอาดบ้าน</option>
        <option>ทำความสะอาดคอนโด</option>
        <option>ทำความสะอาดสำนักงาน</option>
        <option>Big Cleaning</option>
      </select>

      <label>ประเภทสถานที่ <span class="req">*</span></label>
      <select id="property_type">
        <option value="">เลือกประเภท</option>
        <option>บ้าน</option>
        <option>คอนโด</option>
        <option>สำนักงาน</option>
      </select>
    </div>

    <!-- STEP 2 -->
    <div id="step2" style="display:none">
      <label>วันที่ <span class="req">*</span></label>
      <input id="preferred_date" type="date">
      <label>เวลา <span class="req">*</span></label>
      <input id="preferred_time" type="time">
      <label>ที่อยู่หน้างาน <span class="req">*</span></label>
      <textarea id="address"></textarea>
    </div>

    <!-- STEP 3 -->
    <div id="step3" style="display:none">
      <label>เบอร์โทร <span class="req">*</span></label>
      <input id="phone">
      <label>อีเมล</label>
      <input id="email">
    </div>

    <!-- STEP 4 -->
    <div id="step4" style="display:none">
      <div class="note"><b>ข้อตกลงและเงื่อนไข</b></div>

      <div id="termsBox" style="max-height:240px;overflow:auto;border:1px solid #dbe7ff;border-radius:12px;padding:12px;background:#fff;font-size:13px;line-height:1.6">
        1. ขอบเขตงาน: ทำความสะอาดทั่วไป ไม่รวมงานเสี่ยง<br><br>
        2. กรุณาเก็บของมีค่าให้เรียบร้อย<br><br>
        3. รับประกันความเสียหายภายใน 24 ชม. ไม่เกิน 3,000 บาท<br><br>
        4. บริษัทเตรียมอุปกรณ์ครบ<br><br>
        5. เลื่อน/ยกเลิก แจ้งล่วงหน้า 24 ชม.<br><br>
        6. อาจมีการถ่ายภาพผลงานโดยไม่เปิดเผยข้อมูลส่วนตัว
      </div>

      <div id="acceptWrap" style="margin-top:12px;opacity:.4;pointer-events:none">
        <label><input type="checkbox" id="acceptTerms"> ยอมรับเงื่อนไขทั้งหมด</label>
      </div>
    </div>

  </div>

  <div class="foot">
    <button class="btn secondary" onclick="back()">ย้อนกลับ</button>
    <button class="btn" onclick="next()">ถัดไป</button>
    <button class="btn" id="btnSend" onclick="send()" style="display:none">ส่งคำขอจอง</button>
  </div>
</div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw3LJtWX8R9bMIXNjhyBY3kOltxRferwjklRYop-G-hBNYc8JL8omHx8D1AEFi-i7mL/exec";
const LIFF_ID = "2008701497-JZA86efs";
let step = 1, PROFILE=null;

function setStep(){
  for(let i=1;i<=4;i++){
    document.getElementById("step"+i).style.display = i===step?"block":"none";
    document.getElementById("p"+i).style.width = i<=step?"100%":"0%";
  }
  btnSend.style.display = step===4?"inline-block":"none";
}

function next(){ if(step<4) step++; setStep(); }
function back(){ if(step>1) step--; setStep(); }

const termsBox=document.getElementById("termsBox");
const acceptWrap=document.getElementById("acceptWrap");
termsBox.addEventListener("scroll",()=>{
  if(termsBox.scrollTop+termsBox.clientHeight>=termsBox.scrollHeight-5){
    acceptWrap.style.opacity="1";
    acceptWrap.style.pointerEvents="auto";
  }
});

async function init(){
  await liff.init({liffId:LIFF_ID});
  if(!liff.isLoggedIn()){liff.login();return;}
  PROFILE=await liff.getProfile();
  who.textContent="ผู้ใช้งาน: "+PROFILE.displayName;
  setStep();
}
init();

function send(){
  if(!acceptTerms.checked){
    msg.innerHTML='<div class="alert err">กรุณายอมรับเงื่อนไข</div>';return;
  }
  msg.innerHTML='<div class="alert ok">ขอบคุณครับ ระบบได้รับข้อมูลแล้ว เจ้าหน้าที่จะติดต่อกลับโดยเร็ว</div>';
  btnSend.disabled=true;
}
</script>
</body>
</html>
