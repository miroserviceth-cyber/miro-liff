<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MIRO | ‡∏à‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
/* ===== CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ===== */
:root{
  --bg:#f3f7ff;
  --card:#ffffff;
  --ink:#0b2b5a;
  --muted:#5b6b80;
  --line:#dbe7ff;
  --primary:#1677ff;
  --primary2:#0ea5e9;
  --danger:#dc2626;
  --ok:#0f766e;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto;background:var(--bg);color:var(--ink)}
.wrap{max-width:760px;margin:0 auto;padding:18px 16px 40px}
.req{color:var(--danger);font-weight:800}

/* ===== ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Thank You ===== */
.thankyou{
  background:#fff;
  border:1px solid var(--line);
  border-radius:18px;
  padding:36px 24px;
  text-align:center;
  box-shadow:0 18px 40px rgba(15,23,42,.08);
}
.thankyou h2{
  margin:0;
  font-size:20px;
  font-weight:900;
}
.thankyou p{
  margin-top:12px;
  color:var(--muted);
  line-height:1.6;
}
.ticket{
  margin:18px auto;
  padding:14px;
  border-radius:14px;
  background:#f0f7ff;
  border:1px dashed #99c2ff;
  font-weight:900;
  font-size:18px;
  color:#0b2b5a;
  letter-spacing:.5px;
}
</style>
</head>

<body>
<div class="wrap" id="appRoot">

  <!-- ===== ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ===== -->
  <!-- (‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ ‡πÑ‡∏°‡πà‡∏•‡∏ö ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏°‡∏≤) -->

</div>

<script>
/* ===== CONFIG ‡πÄ‡∏î‡∏¥‡∏° ===== */
const API_URL = "https://script.google.com/macros/s/AKfycbw3LJtWX8R9bMIXNjhyBY3kOltxRferwjklRYop-G-hBNYc8JL8omHx8D1AEFi-i7mL/exec";
const LIFF_ID = "2008701497-JZA86efs";
const OA_CHAT_URL = "https://line.me/R/ti/p/@017lvaas";

/* ===== send() ‡πÅ‡∏Å‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô success ===== */
async function send(){
  msg.innerHTML = "";
  const err = validateStep(4) || (consent.value ? "" : "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç");
  if(err){
    showErr(err);
    return;
  }

  const payload = {
    line_user_id: PROFILE.userId,
    display_name: PROFILE.displayName || "",
    phone: phone.value.trim(),
    email: email.value.trim(),
    contact_method: contact_method.value.trim(),
    service_type: service_type.value.trim(),
    property_type: property_type.value.trim(),
    area_sqm: area_sqm.value.trim(),
    bedrooms: bedrooms.value.trim(),
    bathrooms: bathrooms.value.trim(),
    floor: floor.value.trim(),
    has_elevator: has_elevator.value.trim(),
    parking: parking.value.trim(),
    preferred_date: preferred_date.value.trim(),
    preferred_time: preferred_time.value.trim(),
    address: address.value.trim(),
    map_url: map_url.value.trim(),
    notes: notes.value.trim(),
    consent: consent.value.trim()
  };

  const q = new URLSearchParams({ action:"create_booking" });
  for(const k in payload){
    q.set(k, payload[k]);
  }

  try{
    btnSend.disabled = true;
    btnBack.disabled = true;

    const data = await jsonp(API_URL + "?" + q.toString());

    if(data && data.success){
      // üî• ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Thank You
      document.getElementById("appRoot").innerHTML = `
        <div class="thankyou">
          <h2>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h2>
          <p>
            ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß<br>
            ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏¥‡∏ß‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡πá‡∏ß
          </p>

          <div class="ticket">
            ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏à‡∏≠‡∏á<br>
            ${data.booking_id}
          </div>

          <p>
            ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
          </p>

          <a href="${OA_CHAT_URL}" style="
            display:inline-block;
            margin-top:18px;
            padding:12px 16px;
            background:#1677ff;
            color:#fff;
            border-radius:14px;
            text-decoration:none;
            font-weight:900
          ">
            ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ LINE Official
          </a>
        </div>
      `;
    }else{
      showErr((data && data.error) ? data.error : "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ");
      btnSend.disabled = false;
      btnBack.disabled = false;
    }

  }catch(e){
    showErr("‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + String(e.message||e));
    btnSend.disabled = false;
    btnBack.disabled = false;
  }
}
</script>
</body>
</html>
